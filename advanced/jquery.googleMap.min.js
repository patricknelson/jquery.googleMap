/**
* jQuery Google Map Helper
* Copyright (c) 2012 Kevin Doyle & Jonathan Hopkins
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
**/

(function(a){a.fn.googleMap=function(f){f=a.extend({mapType:"roadmap",url:"data.json"},f);return this.each(function(){var m=a(this)[0],d,e,h,l,g,k;switch(f.mapType){case "roadmap":d=google.maps.MapTypeId.ROADMAP;break;case "satellite":d=google.maps.MapTypeId.SATELLITE;break;case "hybrid":d=google.maps.MapTypeId.HYBRID;break;case "terrain":d=google.maps.MapTypeId.TERRAIN}d={zoom:8,maxZoom:15,center:new google.maps.LatLng(0,0),mapTypeId:d};e=new google.maps.Map(m,d);k=new google.maps.InfoWindow;a.ajax({type:"GET", dataType:"json",url:f.url,success:function(b){for(i=0;i<b.sets.length;i++){var c=b.sets[i];h=new google.maps.LatLngBounds;for(j=0;j<c.points.length;j++){var d=c.points[j];l=new google.maps.LatLng(d.latlng[0],d.latlng[1]);g=new google.maps.Marker({map:e,position:l,icon:c.points[j].icon?c.points[j].icon:null});d.marker=g;google.maps.event.addListener(g,"click",function(a,c,d){return function(){k.setContent(b.sets[d].points[c].content);k.open(e,a)}}(g,j,i));h.extend(g.getPosition())}c.bounds=h}c=""; if(null!==b.initialset){for(i=0;i<b.sets.length;i++)b.sets[i].setid===b.initialset&&(c=b.sets[i]);""==c&&(c=b.sets[0])}else c=b.sets[0];e.fitBounds(c.bounds);a(".goto").removeClass("current");a('a.goto[data-id="'+c.setid+'"]').addClass("current");a(".goto").click(function(){curid=a(this).data("id");for(i=0;i<b.sets.length;i++)b.sets[i].setid===curid&&(e.fitBounds(b.sets[i].bounds),e.setZoom(Math.min(e.getZoom(),15)),a(".goto").removeClass("current"),a(this).addClass("current"));return!1});a(".toggle").click(function(){curid= a(this).data("id");for(i=0;i<b.sets.length;i++)if(b.sets[i].setid===curid)for(j=0;j<b.sets[i].points.length;j++)curmarker=b.sets[i].points[j].marker,curmarker.getVisible()?(curmarker.setVisible(!1),a('a.toggle[data-id="'+curid+'"]').addClass("invisible")):(curmarker.setVisible(!0),a('a.toggle[data-id="'+curid+'"]').removeClass("invisible"));return!1});a("#mapaddressform").submit(function(){(new google.maps.Geocoder).geocode({address:a("#mapaddress").val()},function(a,b){b===google.maps.GeocoderStatus.OK? (e.setCenter(a[0].geometry.location),e.setZoom(14)):b===google.maps.GeocoderStatus.ZERO_RESULTS&&f.onGeocodeError.call(this)});return!1})}})})}})(jQuery);